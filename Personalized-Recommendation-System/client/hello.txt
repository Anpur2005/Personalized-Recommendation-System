#include <stdio.h>
#include <string.h>

void xorDivision(char* dividend, const char* divisor) {
    int lenDivisor = strlen(divisor);
    for (int i = 0; i <= strlen(dividend) - lenDivisor; i++) {
        if (dividend[i] == '1') {
            for (int j = 0; j < lenDivisor; j++) {
                dividend[i + j] = (dividend[i + j] == divisor[j]) ? '0' : '1';
            }
        }
    }
}

void calculateCRC(char* data, const char* generator) {
    int dataLen = strlen(data);
    int genLen = strlen(generator);

    // Append n-1 zeros to the data
    for (int i = 0; i < genLen - 1; i++) {
        data[dataLen + i] = '0';
    }
    data[dataLen + genLen - 1] = '\0';

    // Copy data to dividend for division
    char dividend[100];
    strcpy(dividend, data);

    // Perform XOR division
    xorDivision(dividend, generator);

    // Append CRC to data
    for (int i = 0; i < genLen - 1; i++) {
        data[dataLen + i] = dividend[dataLen + i];
    }
}

int checkCRC(char* received, const char* generator) {
    // Perform XOR division on the received data
    xorDivision(received, generator);

    // Check if remainder is all zeros
    for (int i = 0; i < strlen(generator) - 1; i++) {
        if (received[strlen(received) - strlen(generator) + 1 + i] != '0') {
            return 0; // Error detected
        }
    }
    return 1; // No error
}

int main() {
    char data[100];
    char generator[20];
    char received[100];

    printf("Enter data to be transmitted (binary): ");
    scanf("%s", data);

    printf("Enter generator polynomial (binary): ");
    scanf("%s", generator);

    calculateCRC(data, generator);

    printf("CRC checksum: ");
    for (int i = strlen(data) - strlen(generator) + 1; i < strlen(data); i++) {
        printf("%c", data[i]);
    }
    printf("\n");

    printf("Transmitted data with CRC: %s\n", data);

    printf("Enter received data (binary): ");
    scanf("%s", received);

    if (checkCRC(received, generator)) {
        printf("No errors detected. Data received correctly.\n");
    } else {
        printf("Error detected in the received data!\n");
    }

    return 0;
}